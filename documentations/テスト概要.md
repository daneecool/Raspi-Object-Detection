# ãƒ†ã‚¹ãƒˆæ¦‚è¦

```bash
comas@raspi:~ $ source raspi/bin/activate
(raspi) comas@raspi:~ $ python3 test_raspi_detection.py

======================================================================
ğŸ“ RASPBERRY PI 3B v1.2 OBJECT DETECTION TEST SUITE
======================================================================
Setting up Pi-optimized test environment...
Platform: Linux-6.12.47+rpt-rpi-v8-aarch64-with-glibc2.41
Architecture: aarch64
Python: 3.13.5
Total RAM: 0.9 GB
Available RAM: 0.6 GB
âœ… Running on Raspberry Pi
âœ“ Pi test configuration loaded
----------------------------------------------------------------------
test_01_pi_environment_check (__main__.TestRaspberryPiDetection.test_01_pi_environment_check)
Test 1: Verify Pi environment and dependencies ...
ğŸ”§ Test 1: Pi Environment Check
------------------------------
âœ“ Architecture: aarch64
âœ“ OpenCV: 4.12.0
âœ“ Memory: 0.9GB (Pi constraint verified)
âœ“ CPU cores: 4
Test 1 PASSED: Pi environment verified (Time: 0.00s)
ok
test_02_ultralytics_import_optimized (__main__.TestRaspberryPiDetection.test_02_ultralytics_import_optimized)
Test 2: Test YOLO import with memory monitoring ...
ğŸ“¦ Test 2: Ultralytics Import (Memory Optimized)
---------------------------------------------
Initial memory: 248.9 MB
âœ“ Import time: 0.00 seconds
âœ“ Memory after import: 248.9 MB
âœ“ Import memory increase: 0.0 MB
Test 2 PASSED: Ultralytics import verified (Time: 0.00s)
ok
test_03_model_loading_pi_optimized (__main__.TestRaspberryPiDetection.test_03_model_loading_pi_optimized)
Test 3: Model loading with Pi memory constraints ...
ğŸ¤– Test 3: Model Loading (Pi Optimized)
-----------------------------------
Memory before model load: 248.9 MB
âœ“ Model load time: 0.45 seconds
âœ“ Memory after model: 265.0 MB
âœ“ Model memory increase: 16.1 MB
Test 3 PASSED: Model loading verified for Pi (Time: 0.78s)
ok
test_04_camera_detection_pi (__main__.TestRaspberryPiDetection.test_04_camera_detection_pi)
Test 4: Camera detection on Pi ...
ğŸ“· Test 4: Camera Detection (Pi)
-------------------------
âœ“ Camera detected
âœ“ Camera resolution: 640.0x480.0
âœ“ Frame captured: (480, 640, 3)
Test 4 PASSED: Camera detection checked (Time: 0.48s)
ok
test_05_inference_speed_pi (__main__.TestRaspberryPiDetection.test_05_inference_speed_pi)
Test 5: Inference speed test optimized for Pi ...
âš¡ Test 5: Inference Speed (Pi Optimized)
-----------------------------------
Warming up model...
Running Pi inference speed test...
  Run 1: 3946.3ms
  Run 2: 3201.3ms
  Run 3: 3210.8ms
  Run 4: 3927.4ms
  Run 5: 2896.7ms
âœ“ Average inference: 3436.5ms
âœ“ Min time: 2896.7ms
âœ“ Max time: 3946.3ms
âœ“ Estimated FPS: 0.3
Test 5 PASSED: Pi inference speed verified (Time: 24.72s)
ok
test_06_memory_stress_pi (__main__.TestRaspberryPiDetection.test_06_memory_stress_pi)
Test 6: Memory stress test for Pi constraints ...
ğŸ’¾ Test 6: Memory Stress (Pi Constraints)
-----------------------------------
Initial memory: 304.9 MB
Running Pi memory stress test...
  Iteration 1: 311.9 MB
  Iteration 4: 305.5 MB
  Iteration 7: 305.5 MB
  Iteration 10: 305.5 MB
âœ“ Peak memory: 311.9 MB
âœ“ Memory increase: 7.0 MB
âœ“ Final memory: 305.5 MB
Test 6 PASSED: Pi memory constraints verified (Time: 35.92s)
ok
test_07_obj_detection_integration (__main__.TestRaspberryPiDetection.test_07_obj_detection_integration)
Test 7: Integration test with actual obj_detection.py ...
ğŸ”— Test 7: obj_detection.py Integration
-----------------------------------
OpenCV version: 4.12.0
Platform: Linux-6.12.47+rpt-rpi-v8-aarch64-with-glibc2.41
Python version: 3.13.5
  Running on Raspberry Pi
  Device: Raspberry Pi 3 Model B Rev 1.2
Loading YOLO11n model...
Exporting model to NCNN format for Raspberry Pi optimization...
Ultralytics 8.3.217 ğŸš€ Python-3.13.5 torch-2.9.0+cpu CPU (aarch64)
YOLO11n summary (fused): 100 layers, 2,616,248 parameters, 0 gradients, 6.5 GFLOPs

PyTorch: starting from 'yolo11n.pt' with input shape (1, 3, 640, 640) BCHW and output shape(s) (1, 84, 8400) (5.4 MB)

ONNX: starting export with onnx 1.19.1 opset 22...
ONNX: slimming with onnxslim 0.1.71...
2025-10-22 17:19:47.439364738 [W:onnxruntime:Default, device_discovery.cc:164 DiscoverDevicesForPlatform] GPU device discovery failed: device_discovery.cc:89 ReadFileContents Failed to open file: "/sys/class/drm/card0/device/vendor"
ONNX: export success âœ… 17.8s, saved as 'yolo11n.onnx' (10.2 MB)

NCNN: starting export with NCNN 1.0.20250916...
NCNN: running '/home/comas/raspi/lib/python3.13/site-packages/ultralytics/pnnx yolo11n.onnx ncnnparam=yolo11n_ncnn_model/model.ncnn.param ncnnbin=yolo11n_ncnn_model/model.ncnn.bin ncnnpy=yolo11n_ncnn_model/model_ncnn.py pnnxparam=yolo11n_ncnn_model/model.pnnx.param pnnxbin=yolo11n_ncnn_model/model.pnnx.bin pnnxpy=yolo11n_ncnn_model/model_pnnx.py pnnxonnx=yolo11n_ncnn_model/model.pnnx.onnx fp16=0 device=cpu inputshape="[1, 3, 640, 640]"'
pnnxparam = yolo11n_ncnn_model/model.pnnx.param
pnnxbin = yolo11n_ncnn_model/model.pnnx.bin
pnnxpy = yolo11n_ncnn_model/model_pnnx.py
pnnxonnx = yolo11n_ncnn_model/model.pnnx.onnx
ncnnparam = yolo11n_ncnn_model/model.ncnn.param
ncnnbin = yolo11n_ncnn_model/model.ncnn.bin
ncnnpy = yolo11n_ncnn_model/model_ncnn.py
fp16 = 0
optlevel = 2
device = cpu
inputshape = [1,3,640,640]f32
inputshape2 =
customop =
moduleop =
get inputshape from traced inputs
inputshape = [1,3,640,640]f32
inputshape2 =
############# pass_level0 onnx
inline_containers ...                 0.01ms
eliminate_noop ...                    2.39ms
fold_constants ...                    1.62ms
canonicalize ...                      4.05ms
shape_inference ...                4010.85ms
fold_constants_dynamic_shape ...      5.56ms
inline_if_graph ...                   1.00ms
fuse_constant_as_attribute ...       31.96ms
eliminate_noop_with_shape ...         5.61ms
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚ orig     â”‚ opt      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ node             â”‚ 320      â”‚ 320      â”‚
â”‚ initializer      â”‚ 196      â”‚ 186      â”‚
â”‚ functions        â”‚ 0        â”‚ 0        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ nn module op     â”‚ 0        â”‚ 0        â”‚
â”‚ custom module op â”‚ 0        â”‚ 0        â”‚
â”‚ aten op          â”‚ 0        â”‚ 0        â”‚
â”‚ prims op         â”‚ 0        â”‚ 0        â”‚
â”‚ onnx native op   â”‚ 320      â”‚ 320      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Add              â”‚ 16       â”‚ 16       â”‚
â”‚ Concat           â”‚ 23       â”‚ 23       â”‚
â”‚ Conv             â”‚ 88       â”‚ 88       â”‚
â”‚ Div              â”‚ 1        â”‚ 1        â”‚
â”‚ MatMul           â”‚ 2        â”‚ 2        â”‚
â”‚ MaxPool          â”‚ 3        â”‚ 3        â”‚
â”‚ Mul              â”‚ 79       â”‚ 79       â”‚
â”‚ Reshape          â”‚ 8        â”‚ 8        â”‚
â”‚ Resize           â”‚ 2        â”‚ 2        â”‚
â”‚ Sigmoid          â”‚ 78       â”‚ 78       â”‚
â”‚ Slice            â”‚ 2        â”‚ 2        â”‚
â”‚ Softmax          â”‚ 2        â”‚ 2        â”‚
â”‚ Split            â”‚ 11       â”‚ 11       â”‚
â”‚ Sub              â”‚ 2        â”‚ 2        â”‚
â”‚ Transpose        â”‚ 3        â”‚ 3        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
############# pass_level1 onnx
############# pass_level2
############# pass_level3
open failed
############# pass_level4
############# pass_level5
############# pass_ncnn
NCNN: export success âœ… 9.0s, saved as 'yolo11n_ncnn_model' (10.2 MB)

Export complete (38.3s)
Results saved to /home/comas
Predict:         yolo predict task=detect model=yolo11n_ncnn_model imgsz=640
Validate:        yolo val task=detect model=yolo11n_ncnn_model imgsz=640 data=/usr/src/ultralytics/ultralytics/cfg/datasets/coco.yaml
Visualize:       https://netron.app
 Model exported to NCNN format successfully
WARNING âš ï¸ Unable to automatically guess model task, assuming 'task=detect'. Explicitly define task for your model, i.e. 'task=detect', 'segment', 'classify','pose' or 'obb'.
 NCNN model loaded successfully
Testing camera connection...
Attempting to connect to camera 1...
[ WARN:0@113.017] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video1): can't open camera by index
[ERROR:0@113.150] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
 Camera 1 not available, trying camera 0...
Check Camera 0 connected successfully
Resolution: 640x480
FPS: 15.0
 Camera test successful - will use camera 0

============================================================
 STARTING OBJECT DETECTION
============================================================
âœ“ Pi detection result: True
âœ“ Detection info: Raspberry Pi 3 Model B Rev 1.2
âœ“ obj_detection.py integration working
Test 7 PASSED: Integration test completed (Time: 38.99s)
ok
test_08_pi_performance_benchmark (__main__.TestRaspberryPiDetection.test_08_pi_performance_benchmark)
Test 8: Overall Pi performance benchmark ...
ğŸ“Š Test 8: Pi Performance Benchmark
------------------------------
CPU usage: 2.8%
Memory usage: 52.0%
Available memory: 434.5 MB
âœ“ Single inference: 4826.7ms
âœ“ Final CPU: 32.1%
âœ“ Final memory: 51.4%
Test 8 PASSED: Pi performance benchmark completed (Time: 6.92s)
ok

======================================================================
ğŸ“ RASPBERRY PI TEST SUITE COMPLETED
======================================================================
 Pi-Optimized Test Summary:
  âœ“ Test 1: Pi Environment Check â€” 0.00s
  âœ“ Test 2: Ultralytics Import (Memory Optimized) â€” 0.00s
  âœ“ Test 3: Model Loading (Pi Optimized) â€” 0.78s
  âœ“ Test 4: Camera Detection (Pi) â€” 0.48s
  âœ“ Test 5: Inference Speed (Pi Optimized) â€” 24.72s
  âœ“ Test 6: Memory Stress (Pi Constraints) â€” 35.92s
  âœ“ Test 7: obj_detection.py Integration â€” 38.99s
  âœ“ Test 8: Pi Performance Benchmark â€” 6.92s

 ğŸ¯ Your obj_detection.py is ready for Raspberry Pi 3B v1.2!
======================================================================

----------------------------------------------------------------------
Ran 8 tests in 108.718s

OK

```